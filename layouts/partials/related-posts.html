<!-- Related Posts Section -->
{{- $related := slice }}
{{- $categories := .Params.categories }}
{{- if $categories }}
  {{- $related = where .Site.RegularPages ".Params.categories" "intersect" $categories }}
  {{- $related = $related | complement (slice .) }}
  {{- $related = first 3 ($related | shuffle) }}
{{- end }}

{{- if gt (len $related) 0 }}
<div class="related-posts" style="margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--border);">
  <h3 style="margin-bottom: 20px; font-size: 1.2rem;">You May Also Like</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
    {{- range $related }}
    <article style="background: var(--entry); border-radius: 8px; padding: 15px; transition: transform 0.2s;">
      <a href="{{ .RelPermalink }}" style="text-decoration: none; color: inherit;">
        <h4 style="margin: 0 0 8px 0; font-size: 1rem; line-height: 1.4; color: var(--primary);">{{ .Title }}</h4>
        <p style="margin: 0; font-size: 0.85rem; color: var(--secondary); line-height: 1.5;">
          {{ .Summary | truncate 100 }}
        </p>
        <span style="display: block; margin-top: 10px; font-size: 0.75rem; color: var(--secondary);">
          {{ .Date.Format "January 2, 2006" }}
        </span>
      </a>
    </article>
    {{- end }}
  </div>
</div>
{{- end }}
